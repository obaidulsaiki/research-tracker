<div class="app-shell animate-fade-in">
    <app-dashboard-sidebar [activeTab]="activeTab()" (tabChange)="onTabChange($event)"
        (onViewPortfolio)="viewPortfolio()">
    </app-dashboard-sidebar>

    <main class="app-main">
        <app-dashboard-header [activeTab]="activeTab()" (search)="searchTerm.set($event); currentPage.set(1)"
            (onExport)="exportData()" (onAddResearch)="openAddModal()" (excelSelected)="onExcelSelected($event)"
            (fileSelected)="onFileSelected($event)">
        </app-dashboard-header>

        <div class="app-content">
            <router-outlet></router-outlet>
        </div>
    </main>

    @if (successNotification()) {
    <div class="success-toast">
        <div class="toast-content">
            <span class="toast-icon">✨</span>
            <div class="toast-text-group">
                <span class="toast-title">Update Successful</span>
                <span class="toast-msg">{{ successNotification() }}</span>
            </div>
        </div>
    </div>
    }

    @if (errorNotification()) {
    <div class="error-toast">
        <div class="toast-content">
            <span class="toast-icon">⚠️</span>
            <div class="toast-text-group">
                <span class="toast-title">Sync Error</span>
                <span class="toast-msg">{{ errorNotification() }}</span>
            </div>
        </div>
    </div>
    }

    @if (showModal()) {
    <app-add-paper-modal [editData]="itemToEdit()" (close)="closeModal($event)"></app-add-paper-modal>
    }
    @if (confirmDeleteId() !== null) {
    <app-confirm-modal (cancel)="confirmDeleteId.set(null)" (confirm)="handleDelete()"></app-confirm-modal>
    }
    @if (showBulkConfirm()) {
    <app-confirm-modal title="DANGER: Delete All Records?"
        message="This will permanently wipe EVERYTHING from the database: all papers, all authors, and all history logs. This CANNOT be undone."
        confirmText="Yes, WIPE EVERYTHING" (cancel)="showBulkConfirm.set(false)" (confirm)="handleBulkDelete()">
    </app-confirm-modal>
    }
</div>